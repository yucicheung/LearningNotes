# 基本概念(基础)

## 客户端/服务器架构

### 名词说明
- **服务器**:
  - 是一个硬件或软件，用于向一个/多个客户端(客户)提供所需要的＂服务＂。
  - 服务器存在的唯一目的就是等待客户的请求，给这些客户服务，然后再等待其他的请求。
  - 服务器不断处理外来的请求。
- **客户端**
  - 客户端连上一个(预先已知的)服务器，提出自己的请求，等待服务器的完成请求或者说明失败原因的反馈。
  - 客户一次只能提出一个服务的请求，等待结果。
  - 客户之后也可以提出其他的请求，但这个请求会被视为另外一个不同的事务了。

### 架构举例
客户端/服务器架构也可以像应用到软件上上那样应用到计算机硬件上。
- 硬件的客户端/服务器架构
  - 打印机服务器：打印机连续不断处理打印事务，外部计算机逐个向打印机发送打印请求。
  - 文件服务器：一般有大量的存储空间，客户进行远程访问，客户计算机将服务器的磁盘映射到自己本地，就像本地磁盘一样使用它。

- 软件客户端/服务器架构
  - 软件服务器：运行在某个硬件上，提供的服务是程序的运行、数据的发送与接收、合并、升级或其他的程序或数据的操作。
  - web服务器：机器中存放一些网页或web程序，启动服务后，任务是接受客户端的请求，将网页发送到客户端，然后等待下一个请求。
  - 数据库服务：接受客户端的保存或读取请求，完成请求后，继续等待请求。
  - 窗口服务器：运行于一个有显示器的机器上，窗口客户端是在运行时需要窗口环境的程序，即GUI程序。如果在一个DOS窗口或者Unix的shell等无窗口服务器的纯文本环境中运行，将无法启动，只有窗口服务器可用时，一切才能正常使用。在X之类的网络化窗口环境中，还可以选择其他电脑的窗口服务器来做显示，即可以在一台电脑上运行GUI程序，另一台电脑上显示它。

### 与网络编程相关
- 在提供服务前，服务器必须先做一些设置
  - 先创建一个通讯端点，让服务器能够监听请求;
  - 通信端点创建好之后，“监听”的服务器就能进入无限等待和处理客户请求的无限循环之中;
  - 在创建好服务之后，必须将你的服务网址广而告之，否则没有人来请求服务。

- 客户端的编程相对服务端来说简单很多
  - 所有的客户只要创建一个通信端点，建立到服务器的连接，然后客户端就可以提出请求了，请求中，可以包含必要的数据交互;
  - 一旦请求处理完成，客户端收到结果，通信就结束。

## 套接字

### 什么是套接字
- 套接字(IP+UDP/TCP+端口地址的套接)
  - 是一种具有之前所说的“通信端点”概念的计算机网路数据结构。
  - 网络化的应用程序在开始任何通讯之前都必须创建套接字，否则无法进行通信。
  - 套接字起源于加州大学伯克利分校版本的Unix，即BSD Unix，因此套接字也叫"伯克利套接字"或"BSD 套接字"。一开始被设计用在同一台主机上多个应用程序之间的通信(进程间通信，IPC)。

- 套接字分为基于文件型(Unix套接字)和基于网络型(因特网套接字)
  - 基于文件型
	- Unix套接字家族，“家族名”为AF_UNIX(在POSIX1.g标准中也叫做AF_LOCAL)，表示“地址家族：UNIX”。Python中使用的是AF_UNIX。
	- 上述两个进程都是运行在一台机器上，而套接字是基于文件的，其底层结构由文件系统支持，而文件系统是不同的进程都能访问，这就符合服务器/客户端通信模式。
  - 基于网络型：
	- "家族名"为AF_INET，或叫做“地址家族：Internet”;这是使用最广泛的一个。
	- 还有一种地址家族AF_INET6被用于网络协议第6版(IPv6)寻址。
  - 套接字家族让用户代码和内核代码之间的IPC可以使用标准BSD套接字接口。

### 套接字地址

- 一个因特网中的地址由网络通信所必须的主机和端口组成
  - 合法的端口范围是0~65535，其中小于1024的端口号为系统保留端口，在Unix操作系统中，可以通过/etc/services文件获得系统的端口号(及其对应的服务/协议和套接字类型)。
  - **端口之间进行通信必须使用同一种协议**。

### 面向连接与无连接
在所有的地址家族中，套接字的类型都分为有连接和无连接两种。
1. 面向连接的套接字(TCP/IP)
- 在通信之前一定要建立一条连接，这种通信方式也称为“虚电路”或者“流套接字”。
- 面向连接的通信方式提供了顺序的、可靠的、不会重复的数据传输，而且不会加上数据边界，意味着每一个要发送的信息，可能会被拆为多份，每一份都会不多不少地正确到达目的地，然后被重新按照顺序拼装，再传递给目标。
- 实现这种连接的协议是**传输控制协议TCP**(虚电路要三次握手、四次挥手进行建立和关闭)。
  - 要创建TCP套接字就得在创建时指定套接字类型为SOCK_STREAM，这个名字就表示它作为流套接字的特点(信息分段再重组)。
- 套接字使用网际协议IP来查找网络中的主机，所以整个系统由这两个协议名的组合来描述，即TCP/IP。
  - TCP负责数据的传输，而IP负责导向。

2. 无连接的套接字(UDP/IP)
- 这是与虚电路完全相反的，数据报型的无连接套接字，即**无需建立连接就可以进行通讯**。
- 无法保证数据到达的顺序、可靠性和不重复性;数据报会保留数据边界，即数据是整个发送的，不会向面向连那样先拆分成小块。
- 尽管缺点很多，但是因为成本更低，所以某些应用场合下更适合用无连接的套接字(面向连接的套接字要提供一些保证，以及要维持虚电路连接，这些都是很重的额外负担)。
- 实现这种连接的主要协议就是**用户数据报协议(即UDP)**
  - 创建UDP套接字就要在创建时指定套接字的类型为SOCK_DGRAM，其中`DGRAM`来自单词"datagram"(数据报)。
- 仍然使用网际协议查找网络中主机，形成的整个系统，就由两个协议名的组合来描述，即UDP/IP。
  - UDP负责数据传输，IP负责地址导向。

