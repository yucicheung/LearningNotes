# 管道
管道是一种最基本的IPC(Inter-Process-Communication，进程间通信)机制，作用于有血缘关系的进程之间(子进程由管道命令根据父进程创建，并将该进程交给管道后程序执行)，完成数据传递。

关于管道的几个特质：
1. 其本质是一个伪文件(实为内核缓冲区);
2. 由两个文件描述符引用，一个表示读端，一个表示写端;
3. 规定数据从管道的写端流入管道，从读端流出;

管道的原理：管道实为内核使用**环形队列机制**(此时最多取出部分内容，而不是缓冲全部内容，加速管道处理过程以及减少内存占用)，借助内核缓冲区实现。

管道的局限性：
1. 数据被一个进程读，不能被同一个进程写;
2. 数据一旦被读走，就不再在管道中存在，不可反复读取;
3. 管道采用半双工通信，数据只能在一个方向上流动;
4. 只能在有公共祖先的进程间使管道(子进程会被父进程创建)。

管道的创建函数`pipe`
```
int pipe(int pipefd[2]);//成功:0，失败:-1
```
函数调用成功返回r/w两个文件描述符(fd[2]数组)，无需Open，但要手动close。规定:fd[0]指向读端r，fd[1]指向写端w。
**向管道文件读写数据就是在读写内核缓冲区**。

在管道创建成功以后，创建管道的父进程同时掌握着管道的读端和写端，要**实现父子进程之间的通信，采用如下步骤：**
1. 父进程调用pipe函数创建管道，得到两个文件描述符，fd[0]/fd[1]分别指向管道的读端和写端。
2. 父进程调用fork函数创建子进程，那么子进程也有两个文件描述符指向同一管道。
3. **父进程关闭读通道，子进程关闭写通道，**父进程向管道写数据，子进程从管道中读数据。管道是环形队列，管道从写端流入管道，从读端流出，这就实现了进程间通信。
