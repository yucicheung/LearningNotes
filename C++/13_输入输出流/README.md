#13 输入输出流

- cin/cout/cerr/clog是定义在<iostream>头文件中的四种流对象，其中c表示console。
- cerr是用用户自己定义的错误信息，它只能被输出到控制台/屏幕而不像cout还可以被重定向到文件中。
- clog也是向屏幕输出错误信息，但是其信息存放在缓存区中，缓冲区满或遇见endl才向显示器输出。而cerr不经过缓冲区直接向显示器输出。
- 格式输出可以在用控制符表示，也可以用cout流中的格式控制函数表示。在利用控制符控制时，可以在一条cout语句中连续使用多种控制符。
- 输出单个字符的函数有cout流对象中的`put`函数，也有保留自C语言，在<iostream>中定义的`putchar`函数。

- 文件的末尾是EOF，是在<iostream>中定义的符号常量,代表-1。如果在输入控制台中要输入`EOF`，则用ctrl+z/ctrl+D表示。

- `putback`函数
  - `cin.putback(ch)`作用是用`get`/`getline`函数从读入流中读取的字符ch插入到输入流的当前指针处。

## 对数据文件的操作和文件流
### 文件
- 文件是存储在外部介质上数据的集合。
- 操作系统是以文件为单位对数据进行管理的。
- 文件分类
  - 程序文件，如源程序文件(.cpp)、目标文件(.obj)、可执行文件(.exe)等;
  - 数据文件，如将运行过程中程序将操作的数据对象存储在磁盘中。
- 数据文件按组织形式分类
  - ASCII文件，即文本文件/字符文件，一个字节代表一个字符，一般需要转化成屏幕上可打印格式，因此速度慢、占用空间多;
  - 二进制文件，内部格式文件/字节文件，将内存中的存储形式原样输出到磁盘上存储，不需要转换时间，且可以节省外存空间。
- 高级I/O是若干个字节组合为一个有意义的单位，然后以ASCII字符形式(数据转化为字符)输入和输出。低级I/O是以字节为单位的输入和输出，在I/O时不进行格式的转换。

## 文件流和文件流对象
- I/O分为
  - 标准I/O
  - 文件I/O
  - 串I/O
- cin/cout只能处理C++中以标准设备为对象的输入输出，而不能处理以磁盘文件为对象的输入输出流对象;
- **文件流**：以外存文件为输入输出对象的数据流，每一个文件流都有一个内存缓冲区与之对应。
- 用于文件操作的文件类
  - ifstream类
  - ofstream类
  - fstream类

### 文件读写基础
- 直接用构造函数定义文件流即可，打开成功时返回非0值，否则返回0;
- 文件流类
  - ifstream
	- 只能用于从文件读取，因此一切输出的函数不存在;
	- 默认已包含`ios::in`;
  - ofstream
	- 只能向文件输出，因此一切输入的函数都不存在;
	- 默认已包含`ios::out`;
  - fstream
	- 可以用于输入和输出;
	- 需要指定`ios::in`和`ios::out`，用`|`来结合不同的IO形式;
- 二进制文件IO
  - 需要指定`ios::binary`模式;
  - 输入输出用`read`/`write`函数，函数会自动实现ASCII码和bin码之间的转化;
  - 函数原型(注意指针类型总是`char *`，len可以用`sizeof`指定)
	```c++
	istream& read(char *buffer,int len);
	ostream& write(const char* buffer,int len);
	```
### 文件指针(文件读写位置标记)控制
- 对二进制文件，允许对位置标记进行控制，文件流对象的相关成员函数(以下`g` for `get`, `p` for `put`)如下
  - `gcount()`，得到最后一次输入所读入的字节数;
  - `tellg()`，得到输入文件(只有输入文件才有`get`成员函数)位置标记的当前位置;
  - `tellp()`，得到输出文件(只有输出文件才有`put`成员函数)位置标记当前的位置;
  - `seekg(文件中的位置)`，将输入文件位置标记移动到指定位置;
  - `seekg(位移量，参照位置)`，以参照位置为基础移动若干字节(正数表示向文件尾移动，负数表示向文件头移动);
  - `seekp(文件中的位置)`，将输出文件位置标记移动到指定位置;
  - `seekp(位移量，参照位置)`，以参照位置为基础移动若干字节;
	- 参照位置，共有3种，`ios::beg`、`ios::cur`、`ios::end`。
```C++
infile.seekg(100);
infile.seekg(-50,ios::cur);
outfile.seekp(-75,ios::end);
```

### 字符串流
- 字符串流是以内存中用户定义的字符数组(字符串)为输入输出的对象，而不是以外存文件为对象。字符串流也称为内存流。
- 字符串流缓冲区的管理办法：缓冲区满/遇换行符/遇字符串结束符`\0`，就将缓冲区中内容一起存入字符数组。
- 字符串数组中存放格式一定是ASCII码，但是利用字符串流对象可以将其他类型的数据从二进制转化为ASCII码存入其中。
- 关于istrstream和ostrstream:
  - i/o标志主要指字符数组和内存单元(如在内存中定义的变量或者各种类型的数组)的关系，i表示从字符数组(ASCII)输入到内存单元中的变量/数组(bin)，o表示从内存单元输出到字符数组。(可以说**字符串流的缓冲区就是字符数组本身**，当字符串流对象和字符数组关联时，内存的输入输出都是直接向这个字符数组占用内存空间进行)。
  - 输出字符串流向字符数组写数据时，总是从数组的首地址开始的。
  - 输入和输出字符串流分别有各自的流位置标记。
- `strstream`是字符串流类：字符串流类关联内存中的一个字符(ASCII码)数组和内存中的二进制数据;
  - 不需要打开和关闭，因为不是文件流;
  - 输出字符串流构造函数原型`ostrstream::ostrstream(char*buffer,int n,int mode=ios::out);`;
  - 输入字符串流构造函数原型`istrstream::istrstream(char*buffer);//将buffer中全部数据作为输入字符串流的内容`/`istrstream::istrstream(char* buffer,int n);//将buffer中前n个字节的内容作为字符串流的内容`;
  - 输入输出字符串流构造函数原型`strstream::strstream(char* buffer,int n,int mode);`;
  - 应该说字符串流的一个很好的特性是，操作符`<<`/`>>`的重载使得字符数组流中的二进制数值能够和不同类型数据之间相互转换。


